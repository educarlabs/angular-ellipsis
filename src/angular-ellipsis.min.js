
angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window","$sce",function(d,f,b){var a=function(h){var i=null;var g=[];this.remove=function(j){if(g.indexOf(j)!==-1){g.splice(g.indexOf(j),1);if(g.length===0){d.cancel(i);i=null}}};this.add=function(j){if(g.indexOf(j)===-1){g.push(j)}if(!i){i=d(function(){var k=g.slice();i=null;g.length=0;k.forEach(function(l){l()})},h)}}};var c=new a(0);var e=new a(75);return{restrict:"A",scope:{ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"="},compile:function(h,g,i){return function(w,r,p){p.lastWindowResizeTime=0;p.lastWindowResizeWidth=0;p.lastWindowResizeHeight=0;p.lastWindowTimeoutEvent=null;p.isTruncated=false;function l(x){var y=0;angular.forEach(x.parent().children(),function(z){if(z!=x[0]){y+=z.clientHeight}});return x.parent()[0].clientHeight-y}var q=r[0];function m(A){var x=[];var z=/\s+/gm;var y;while((y=z.exec(A))!=null){x.push(y.index)}return x}function v(z,x,y){return z.substr(0,x[y])}function o(A,x,z,y){var B=v(A,x,z);q.innerHTML=B+y;return u(r)}function s(){if(typeof(w.ngBind)!=="undefined"){var L=w.ngBind;var I=m(L);p.isTruncated=false;r.html(L);var x=r[0].clientHeight;var F=r[0].scrollHeight;if(F>x){var B=I.length;var z=0;var C=B-1;var K=true;var G;var A=true;var J=true;var y=0;var E=(typeof(p.ellipsisSymbol)!=="undefined")?p.ellipsisSymbol:"&hellip;";var D=(typeof(w.ellipsisAppend)!=="undefined"&&w.ellipsisAppend!=="")?E+"<span>"+w.ellipsisAppend+"</span>":E;while(J){G=z+((C-z)>>1);A=o(L,I,G,D);y++;if((A!=K)&&(C-z)==1){J=false}else{if(A){C=G}else{z=G}}}var H=v(L,I,G)+D;r.html(H);p.isTruncated=true}}}function u(x){return x[0].scrollHeight>x[0].clientHeight}function t(y,x){y=x?y.parent():y;return y[0].scrollHeight>y[0].clientHeight}w.$watch("ngBind",function(){c.add(s)});w.$watch("ngBindHtml",function(){c.add(s)});w.$watch("ellipsisAppend",function(){s()});function n(){if(p.lastWindowResizeWidth!=window.innerWidth||p.lastWindowResizeHeight!=window.innerHeight){s()}p.lastWindowResizeWidth=window.innerWidth;p.lastWindowResizeHeight=window.innerHeight}function j(){e.add(n)}var k=angular.element(f);k.bind("resize",j);w.$on("$destroy",function(){k.unbind("resize",j);c.remove(s);e.remove(n)})}}}}]);